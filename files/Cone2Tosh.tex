\section{Singularities of codimension 2}\label{sec:codmi=2}

Recall that tangent space of a point $p\in A'$ is isometric to the product space $\Cone(\theta)\times\RR^{m-2}$, where $\theta=\theta(p)<2\cdot\pi$. 
Consider the measure $\omega=\omega_A$ on $A'$ defined by
\[\omega=(2\cdot\pi-\theta)\cdot \vol^{m-2}.\eqlbl{eq:omega}\]
Let us extend $\omega$ to the whole space by setting $\omega(S)=\omega(S\cap A')$ for any Borel set $S\subset A$.

Equivalently, the function $\theta$ can be extended by
\[\theta(p)=2\cdot\pi\cdot \tfrac{\vol^{m-1} \Sigma_p}{\vol^{m-1} \mathbb{S}^{m-1}},
\eqlbl{eq:theta}\]
where $\Sigma_p$ denotes the space of directions at $p$.
According to \cite[7.14]{BGP}, $\theta\:A\to \RR$ is upper-semicontinuous.
The right-hand side of the last equality vanish in $A^\circ$.
Further, since $\vol^{m-2}(A'')=0$, the measure $\omega$ could be also defined as a measure on whole $A$ that is defined by~\ref{eq:omega} with $\theta$ defined in \ref{eq:theta}.

Note that \ref{prop:3parts}(\ref{prop:3parts:codim2}) follows from the following more exact statement;
it will be proved in this section.

\begin{thm}{Proposition}\label{prop:3parts:codim2+}
Let $\mathfrak m$ be one of two limit measures $\mathfrak m_i$ in \ref{prop:3parts}.
Then
\[\mathfrak m|_{A'}=\omega\cdot |(d h_{1,n}\wedge\dots\wedge d h_{m,n})(u)|^2,\]
where $u=u(p)$ is a choice of unit $(m-2)$-vector at any point $p\in A'$ in the vertical direction of $\T_p=\Cone(\theta)\times \RR^{m-2}$;
\end{thm}



\subsection{Gauss and mean curvature estimates}

\begin{thm}{Theorem}\label{thm:extimage-of-G-and-H}
Let $f$, $h$ be a pair of strongly convex smooth 1-Lipschitz functions defined on an open set of a 3-dimensional Riemannian manifold.
Suppose that
\begin{enumerate}[(i)]
\item $|\nabla f|\ge 1$ and
\[|\nabla (f+h)|<\eps\cdot|\nabla f|\] 
for some fixed positive $\eps<\tfrac12$;
\item for some $a,b\in \RR$, the set
\[W_{a,b}=\set{p\in M}{f(p)=a, h(p)\le b}\]
is compact.
\end{enumerate}
Denote by $k_1(p)\le k_2(p)$, 
$H(p)\zz=k_1(p)+ k_2(p)$
and
$G(p)=k_1(p)\cdot k_2(p)$, the principle, mean, and Gauss curvatures of $W_{a,b}$ at $p$.
Then
\[\int_{W_{a,b}}G\le 100\cdot\eps
\eqlbl{intG<100eps}\]
and 
\[\int_{W_{a,b}}H\le 10\cdot \sqrt{\eps}\cdot \length(\partial{W_{a,b}}).
\eqlbl{intH<eps}\]
\end{thm}

The proof is based on the 2-dimesional case  following statement,
which is the integral Bochner formula written for function with Dirichlet boundary condition.

\begin{thm}{Proposition}\label{prop:bochner-dirichle}
Assume $\Omega$ is a compact domain with smooth boundary $\partial \Omega$ in a Riemannian manifold
and $f$ is a smooth function that vanish on $\partial \Omega$.
Then
\[\int\limits_\Omega |\Delta f|^2
-|\Hess f|^2
-\langle\mathrm{Ric}(\nabla f),\nabla f\rangle
=\int\limits_{\partial\Omega}
H\cdot|\nabla f|^2,\]
where $H$ denotes mean curvature of $\partial \Omega$.
\end{thm}

\parit{Proof of \ref{thm:extimage-of-G-and-H}.}
Equip $W_{a,b}$ with unit normal vector field $n=\tfrac{\nabla f}{|\nabla f|}$.
Let 
\[S_p\:\T_pW_{a,b}\zz\to \T_pW_{a,b}\]
be the corresponding shape operator, so $S_p\:v\mapsto\nabla_vn$.
Since $f$ is strongly convex, we have that 
\[\langle S_p(v),v\rangle\ge \delta\cdot|v|^2\]
for a fixed value $\delta>0$ and any tangent vector $v\in \T_pW_{a,b}$. 

Note that the restriction of $u=h|_{W_{a,b}}$ is strongly convex.
Moreover 
\[\Hess_pu(v,v)\ge (1-\eps)\cdot \langle S_p(v),v\rangle\eqlbl{Hess=<shape}\]
for any $p\in W_{a,b}$ and $v\in\T_pW_{a,b}$.
Indeed, consider the geodesic $\gamma$ in $W_{a,b}$ such $\gamma(0)=p$ and $\gamma'(0)=v$.
Set $a=\gamma''(t)$.
Note that 
\begin{align*}
a&=-\langle S_p(v),v\rangle \cdot n,
\intertext{Since $h$ is is strongly convex, $\Hess_p h\ge 0$; therefore}
(\Hess_pu)(v,v)&=(\Hess_p h)(v,v)+\langle \nabla_p h,a\rangle\ge
\\
&\ge-\tfrac{\langle\nabla_p h,\nabla_p f\rangle}{|\nabla_p f|}\cdot\langle S_p(v),v\rangle\ge
\\
&\ge (1-\eps)\cdot|\nabla_p f|\cdot\langle S_p(v),v\rangle.
\end{align*}
Since $\nabla f\ge 1$, \ref{Hess=<shape} follows.

Since $\langle S_p(v),v\rangle\ge 0$ and $\eps<\tfrac12$, the inequality \ref{Hess=<shape} implies that 
\[4\cdot \det(\Hess_pu)\ge G(p)
\eqlbl{eq:det>=G}\]
and
\[-2\cdot \Delta u\ge H(p)
\eqlbl{eq:trace>=H}\]
for any $p\in W_{a,b}$.

Denote by  $\lambda_1(p),\lambda_2(p)$ the eigenvalues of  $\Hess_p u$, so
\begin{align*}
\trace(\Hess u)&=\Delta u=\lambda_1+\lambda_2,
\\
|\Hess u|^2&=\lambda_1^2+\lambda_2^2,
\\
\det(\Hess u)&=\lambda_1\cdot\lambda_2,
\intertext{and hence}
2\cdot\det(\Hess u)
&=|\Delta u|^2
-|\Hess u|^2.
\end{align*}

Since $W_{a,b}$ is two-dimensional, by Proposition~\ref{prop:bochner-dirichle} we get that
\[\int\limits_{W_{a,b}} 
2\cdot\det(\Hess u)
=\int\limits_{W_{a,b}} 
K\cdot|\nabla u|^2
+
\int\limits_{\partial W_{a,b}}
\kappa\cdot|\nabla u|^2,\]
where $\kappa\ge 0$ is the geodesic curvature of $\partial W_{a,b}$
and $K$ is the curvature of $W_{a,b}$.

Since $u$ is convex and vanish on the boundary of $W_{a,b}$,
it has unique critical point, which is its minimum.
By Morse lemma,  $W_{a,b}$ is a disc.
Therefore, by Gauss--Bonnet formula, we get that
\[\int_{W_{a,b}} K+\int_{\partial{W_{a,b}}}\kappa=2\cdot\pi.\]
Whence 
\[\int\limits_{W_{a,b}} 
\det(\Hess u)
\le\pi\cdot\sup_{p\in{W_{a,b}}}|\nabla_p u|^2.\]

Note that $\nabla_p u$ is projection of $\nabla_ph$ to $\T_pW_{a,b}$.
Therefore
\begin{align*}
|\nabla_p u|^2&=|\nabla_p h|^2-\langle\nabla_p h,n\rangle^2\le
\\
&\le1-(1-\eps)^2<
\\
&<2\cdot\eps.
\end{align*}
It follows that 
\[\int\limits_{W_{a,b}} 
\det(\Hess u)
\le2\cdot \pi\cdot\eps.\]
Applying \ref{eq:det>=G}, we obtain \ref{intG<100eps}.

Similarly,  by the divergence theorem, we get that
\[-\int\limits_{W_{a,b}} \Delta u=\int\limits_{\partial{W_{a,b}}} |\nabla u|.\]
Whence \ref{eq:trace>=H} implies 
\[\int\limits_{W_{a,b}} H\le 10\cdot \sqrt{\eps}\cdot \length(\partial{W_{a,b}}).\]
\qeds

\subsection{Curvature of level sets}

Let $M$ be a 3-dimensional Riemannian manifold.
Choose a smooth function $f$.
Denote by $L_c$ the level set defined by $f(x)=c$.
If the level set $L_c$ is a smooth surface in a neighborhood of $x\in L_c$,
then denote by $k_1(x)\le k_2(x)$ the principle curvatures of $L_c$ at $x$.
In this case, set 
\begin{align*}
G(x)&=k_1(x)\cdot k_2(x),
\\
H(x)&=k_1(x)+ k_2(x);
\end{align*}
that is, $G(x)$ and $H(x)$ are Gauss and mean curvature of $L_c$ at $x$.

Recall that $\Cone(\theta)$ denotes 2-dimensional cone with total angle $\theta$.

\begin{thm}{Theorem}\label{thm:HG-converge}
Let $M_n\smooths{}\Cone(\theta)\times \RR$ and 
and $f_n\: M_n\to \RR$ be a sequence of strongly concave functions.
Suppose that $\sec M_n\ge -\tfrac1n$ for each $n$, and $f_n$ converges to the $\RR$-coordinate in $\Cone(\theta)\times \RR$ as $n\to \infty$.
Then $G_n$ and $H_n$ (the Gauss and mean curvatures of the level sets of $f_n$) weakly converge to zero.
\end{thm}

\parit{Proof.}
Choose $p\in \Cone(\theta)\times \RR$; set $a=f(p)$.

By theorem of Artem Nepechiy \cite{Nepechiy},
there is a $(-2)$-concave function $\rho$ defined in an $r$-neighborhood of $p$ such that $\rho(x)=-|p-x|^2+o(|p-x|^2)$.
Moreover, the function $\rho$ is \emph{liftable};
that is, there is a sequence of $(-2)$-concave $\rho_n\:M_n\to\RR$ that converges to $\rho$.

Consider a point $q\in \Cone(\theta)\times \RR$ above $p$; that is, its $\RR$-coordinate is larger and its $ \Cone(\theta)$-coordinate is the same.
If $\RR$-coordinate of $q$ is large, then $\dist_q+f$ is $\lambda$-concave for small $\lambda>0$ and it has a nonstrict minimum at $p$.
Therefore, given $\lambda>0$, we can find $q$ so that the sum $s=f+\dist_q+\lambda\cdot \rho$ is $(-\lambda)$-concave and has strict maximum at $p$.
Moreover
\[-\lambda\cdot|p-x|_{\Cone(\theta)\times \RR}^2\ge s(x)-s(p)\ge -\tfrac12\cdot\lambda\cdot|p-x|_{\Cone(\theta)\times \RR}^2\]
and therefore
\[|\nabla_xs|\le 10\cdot\lambda\cdot|p-x|_{\Cone(\theta)\times \RR}
\eqlbl{O(p-x)}\]
if $|p-x|_{\Cone(\theta)\times \RR}$ is sufficiently small; say if $|p-x|_{\Cone(\theta)\times \RR}\le \tfrac r{10}$.

Choose a sequence of points $q_n\in M_n$ that converges to $q$ and set $h_n\zz=\dist_{q_n}+\lambda\cdot \rho_n$;
this is a sequence of liftings of $h=\dist_q+\lambda\cdot \rho$. 
Observe that \ref{O(p-x)} implies that the first condition in \ref{thm:extimage-of-G-and-H} is met for all large $n$ in an $\tfrac r2$-neighborhood of $p_n$ with $\eps=10\cdot\lambda\cdot r$.
Moreover, one can choose $b$ so that the second condition is satisfied and $B_n=B(p_n,r/10)\cap L_a\subset W_{a,b}$.
Applying \ref{thm:extimage-of-G-and-H}, we get that for any $\delta>0$, we have 
\[
\int_{B_n}G_n<\delta,
\quad\text{and}\quad
\int_{B_n}H_n<\delta.
\]
for all large $n$.
It remains to integrate the obtained inequalities by $a$ and pass to a limit as $n\to\infty$.
\qeds

\begin{thm}{Corollary}\label{cor:Ricci}
Suppose that $M_n\smooths{}  \Cone(\theta)\times \RR$ and $f_n\: M_n\to \RR$ be as in \ref{thm:HG-converge}.
Set $u_n=\tfrac{\nabla f_n}{|\nabla f_n|}$.
Then 

\begin{enumerate}[(i)]
\item\label{cor:Ricci:Ricci} $\langle \Ric u_n,u_n\rangle$ weakly converges to zero.
\item\label{cor:Ricci:vw}
Let $v_n$ and $w_n$ are sequences of uniformly bounded, continuous vector fields on $M_n$.
Suppose that $\langle v_n,u_n\rangle$ and $\langle w_n,u_n\rangle$ converge uniformly as $n\to \infty$ to some constants $a$ and $b$ respectively.
Then 
\[\Qm(v_n,w_n)\rightharpoonup a\cdot b\cdot \omega,\]
where $\omega$ is the measure on $\Cone(\theta)\times \RR$  described above.

\end{enumerate}

\end{thm}

\parit{Proof; (\ref{cor:Ricci:Ricci}).}
Passing to a subsequence if nesessary, we can assume weak convergence $\langle \Ric u_n,u_n\rangle\cdot\vol^m$ to a measure $\mu$ on $\Cone(\theta)\times \RR$.
Since $\sec M_n\ge -\tfrac1n$, we have that $\mu\ge 0$.
Therefore it is sufficient to show that $\mu\le 0$.

By \ref{thm:bochner-formula} we have that the following equality
\[\int\limits_\Omega \phi_n\cdot \langle \Ric u_n,u_n\rangle =
\int\limits_\Omega [\phi_n \cdot G_n+H_n\cdot\<u_n,\nabla\phi_n\>-\<\nabla\phi_n,\nabla_{u_n} {u_n}\>]
\]
holds for any function $\phi_n$ with compact support on $M_n$,
assuming that all expressions in the formula have sense.

It remains to find a sequence of nonnegative functions $\phi_n\:M_n\to \RR$ 
with compact support 
that converge to a $\phi\:\Cone(\theta)\times \RR\to \RR$ such that (1) $\phi$ is unit in a neighborhood of a given point $p\in \Cone(\theta)\times \RR$ and (2) we have a control the three terms on the right-hand side of the formula; the latter means that we have the following weak convergences:
\[
\begin{aligned}
\phi_n \cdot G_n&\rightharpoonup 0,
&
H_n\cdot\<u_n,\nabla\phi_n\>&\rightharpoonup 0,
&
\<\nabla\phi_n,\nabla_{u_n} {u_n}\>&\rightharpoonup 0.
\end{aligned}
\eqlbl{eq:3->0}
\]

For the first convergence, it is sufficient to choose the sequence $\phi_n$ so that in addition it is universally bounded.
Indeed, since $|\nabla f_n|\to 1$, we have that \ref{thm:HG-converge} and the coarea formula %???coarea formula
implies the first convergence in \ref{eq:3->0}.

Similarly, to prove the second convergence in \ref{eq:3->0}, it is sufficient to assume in addition that $|\nabla\phi_n|$ is universally bounded and apply \ref{thm:HG-converge} together with the coarea formula.

To prove the last convergence in \ref{eq:3->0}, note that
$|\nabla u_n|\rightharpoonup 0$ away from the singular locus.
The latter follows from Lemma~\ref{lem:test-delta}, mostly part (\ref{lem:test-delta-partial-g}).
Indeed, $\nabla_{u_n} u_n$ can be written in a common chart away from the singular locus. 
The lemma implies that its components converge to the components of $\nabla_u u$ in the limit space.
By assumption $u$ is parallel in the limit space; in particular $\nabla_uu=0$.

The observation above will used to control the term $\<\nabla\phi_n,\nabla_{u_n} {u_n}\>$ at the points far from the singular locus of $\Cone(\theta)\times \RR$.
To do this we only need to assume that $|\nabla\phi_n|$ is bounded.
Next, we describe how to control it near the singularity.

Further, since $|u_n|=1$, we have $\nabla_{u_n} u_n\perp \nabla f_n$.
Therefore if $\nabla \phi_n$ is proportional to $\nabla f_n$ at some point, then at this point we have $\<\nabla\phi_n,\nabla_{u_n} {u_n}\>=0$.
This observation makes it possible to choose $\phi_n$ so that the term $\<\nabla\phi_n,\nabla_{u_n} {u_n}\>$ vanish around the singular locus of $\Cone(\theta)\times \RR$.
Namely in addition to the above conditions on $\phi_n$ we have to assume that the identity $\phi_n=\psi\circ f_n$ holds at the points of $M_n$ that are sufficiently close to the singular locus of $\Cone(\theta)\times \RR$.

Finally observe that the needed sequence exists.
Indeed, one can take 
\[\phi_n=(\sigma\circ \dist_q)\cdot \psi\cdot f_n\]
for appropriately chosen fixed mollifiers $\sigma,\psi\:\RR\to \RR$.

\parit{(\ref{cor:Ricci:vw}).}
Since $G_n\rightharpoonup 0$, we get that curvature measure of level sets of $f_n$ weakly converges to the curvaure of $\Cone(\theta)$.
It follows that 
\[\qm(u_n,u_n)\rightharpoonup \omega.\]

Suppose $v'_n\perp u_n$ for all $n$.
Part (\ref{cor:Ricci:Ricci}) implies that  $\qm(v'_n,v'_n)\rightharpoonup 0$.

Fix $t\in \RR$.
Since the lower bound on sectional curvature of $M_n$ converges to $0$, any partial weak limit of $\qm(v'_n+t\cdot w_n,v'_n+t\cdot w_n)$ is nonnegative.
It follows that 
\[\Qm(v'_n, w_n)\rightharpoonup 0\] for any sequence of fields $v'_n,w_n$ such that $v'_n\perp u_n$.

Consider the vector fields $v_n',w_n'$ such that 
\begin{align*}
v'_n&\perp u_n,
&
v_n&=a_n\cdot u_n+v_n',
\\
w'_n&\perp u_n,
&
w_n&=b_n\cdot u_n+w_n'.
\end{align*}
Since $\Qm$ is bilinear, we get that
\[\Qm(v_n,w_n)=\Qm(v_n',w_n) + a_n\cdot [\Qm(u_n,w_n')+ b_n\cdot \Qm(u_n,u_n)].\]
By assumption, that $a_n=\langle u_n,v_n\rangle $ and $b_n=\langle u_n,w_n\rangle$ uniformly converge to $a$ and $b$ respectively.
Whence the statement follows.
\qeds


